<!DOCTYPE html>
<html>
<head>
    <title>XMLHttpRequest Basic Demo</title>
    <meta charset="utf-8">
</head>
<body>
<script>

    function Handler(strategy, response) {
        this.strategy = strategy;
        this.response = response;
        console.log("The response handler is " + strategy.name);
    }

    Handler.prototype = {
        handleResponse: function () {
            return this.strategy(this.response);
        }
    };


    try {
        // 實例 XMLHttpRequest 物件
        var request = new XMLHttpRequest();

        /*
         * {string} 請求方法 (method)
         * {string} 目標 url
         * {boolean} 非同步 [async]
         * {string} 使用者 [user]
         * {string} 密碼 [password]
         */
        request.open("GET", "https://gank.io/api/random/data/福利/20");

        // 非同步取得回應
        request.onload = function () {

            // 取得回應的 Content-Type 表頭欄位
            // 以決定如何處理回應
            var type = request.getResponseHeader("Content-Type");

            // 建構元 (strategy, response)
            var handler;

            // 使用簡易的 正規表達式，判斷媒體類型
            if (type.match(/^application\/json/)) {
                handler = new Handler(jsonHandler, JSON.parse(request.responseText));
            } else if (type.match(/^application\/xml/)) {
                handler = new Handler(xmlHandler, request.responseXML);
            } else {
                handler = new Handler(textHandler, request.responseText);
            }

            handler.handleResponse();
        };

        request.send(null);

    } catch (e) {
        console.error(e);
    }


    // 敷衍 的處理 JSON 回應
    function jsonHandler(response) {

        var data = response.results;
        for (var i = 0, l = data.length; i < l; i++) {
            var url = data[i].url;
            var img = document.createElement("img");
            img.src = url;
            img.width = 300;

            // 新增 img 元素至頁面
            document.body.appendChild(img);
        }
    }

    // 超級敷衍 的處理 文字 回應
    function textHandler(response) {
        // 新增回應文字至頁面
        document.body.innerHTML = response;
    }

    // 超級敷衍 的處理 XML 回應
    function xmlHandler(response) {
        // 新增回應文字至頁面
        document.body.innerHTML = response;
    }


</script>

</body>
</html>